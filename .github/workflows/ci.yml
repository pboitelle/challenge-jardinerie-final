name: CI

on:
  push:
    branches:
      - master
  pull_request: ~
  workflow_dispatch: ~

jobs:
  api-deploy:
    name: Deploy API
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v2

      - name: Deploy to DigitalOcean
        uses: appleboy/scp-action@master
        with:
          host: ${{ secrets.DIGITALOCEAN_HOST }}
          username: ${{ secrets.DIGITALOCEAN_USERNAME }}
          key: ${{ secrets.DIGITALOCEAN_SSH_KEY }}
          source: "challenge-jardinerie-final"
          target: "/challenge-jardinerie-final"

      - name: Restart Server
        uses: appleboy/ssh-action@master
        with:
          host: ${{ secrets.DIGITALOCEAN_HOST }}
          username: ${{ secrets.DIGITALOCEAN_USERNAME }}
          key: ${{ secrets.DIGITALOCEAN_SSH_KEY }}
          script: |
            SERVER_NAME=challenge-jardinerie.site \ 
            docker compose up -d  
            # Exemple pour redémarrer le serveur web (à adapter à votre configuration)